!function(){"use strict";var e=window.wp.element,t=window.React;let a=null;async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"react";const i=function(){if("undefined"!=typeof swishWaitPageData)return{ajaxUrl:swishWaitPageData.ajaxUrl,nonce:swishWaitPageData.nonce,frontendLogging:swishWaitPageData.frontendLogging};if("undefined"!=typeof swish)return{ajaxUrl:swish.ajaxurl,nonce:swish.nonce,frontendLogging:swish.frontendLogging};const e=function(){if(null!==a)return a;try{if("undefined"!=typeof wc&&wc.wcSettings&&"function"==typeof wc.wcSettings.getSetting){const e=wc.wcSettings.getSetting("swish_data",null);if(e)return a=e,e}}catch(e){}return a=!1,null}();return e?{ajaxUrl:e.ajaxUrl,nonce:e.nonce,frontendLogging:e.frontendLogging}:{ajaxUrl:null,nonce:null,frontendLogging:!1}}();if(!i.frontendLogging||!i.ajaxUrl)return void console.log(`[Swish:${n}] ${e}`);const s=new FormData;s.append("action","swish_frontend_log"),s.append("nonce",i.nonce),s.append("message",e),s.append("level",t),s.append("context",n);try{await fetch(i.ajaxUrl,{method:"POST",body:s,credentials:"same-origin"})}catch(e){console.error("[SwishLogger] Failed to send log:",e)}}const i={log:function(e){n(e,"info",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"react")},warn:function(e){n(e,"warning",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"react")},error:function(e){n(e,"error",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"react")}};var s=i;async function o(e,t){const a=await async function(e,t){const a=new FormData;a.append("action","wait_for_payment"),a.append("url",window.location.href),a.append("nonce",swishWaitPageData.nonce),s.log("pollPaymentStatus: Polling for payment status","wait-page");try{const n=await fetch(swishWaitPageData.ajaxUrl,{method:"POST",body:a,credentials:"same-origin"}),i=await n.json();return e(i.message),t(i.status),"WAITING"!==i.status&&(s.log(`pollPaymentStatus: Payment status changed to ${i.status}`,"wait-page"),"PAID"===i.status?(s.log("pollPaymentStatus: Payment completed, redirecting to confirmation","wait-page"),setTimeout((()=>{window.location.replace(i.redirect_url)}),1e3)):(s.log(`pollPaymentStatus: Redirecting to ${i.redirect_url}`,"wait-page"),window.location.replace(i.redirect_url))),i.status}catch(t){return s.error(`pollPaymentStatus: Error polling payment status - ${t}`,"wait-page"),console.error("Error:",t),e(t),"ERROR"}}(e,t);"WAITING"===a?setTimeout((()=>o(e,t)),1e3):s.log(`checkPaymentStatus: Final status is ${a}`,"wait-page")}function r(){const[a,n]=(0,t.useState)("WAITING"),[i,r]=(0,t.useState)(swishWaitPageData.initialMessage),[c]=(0,t.useState)(swishWaitPageData.swishFullLogo);return(0,t.useEffect)((()=>{s.log(`SwishWaitPage: Component mounted, order ID: ${swishWaitPageData.orderId}`,"wait-page");const e=()=>{document.hidden||"WAITING"!==a||s.log("SwishWaitPage: Visibility change detected, checking payment status","wait-page")};return o(r,n),document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[a]),(0,e.createElement)("div",{className:"swish_container"},(0,e.createElement)("div",{className:"swish-messages-internal swish-centered-internal"},(0,e.createElement)("h1",null,(0,e.createElement)("p",{className:"swish-status-new",id:"swish-status"},i)),!(swishWaitPageData.qrCode&&""!==swishWaitPageData.qrCode)&&(0,e.createElement)("div",{className:"swish-logo swish-centered-internal swish-logo-internal"},(0,e.createElement)("img",{src:c,alt:"Swish Logo"})),swishWaitPageData.qrCode&&""!==swishWaitPageData.qrCode?(0,e.createElement)("div",{className:"swish-qr-code"},(0,e.createElement)("img",{src:`data:image/svg+xml;base64,${swishWaitPageData.qrCode}`,alt:"Swish QR Code",style:{width:"50%",height:"auto"}})):swishWaitPageData.showGotoSwishButton&&(0,e.createElement)("div",{className:"swish-button-internal swish-notwaiting"},(0,e.createElement)("a",{href:swishWaitPageData.swishRedirectUrl,className:"button gotoswish"},swishWaitPageData.showGotoSwishButtonText))))}function c(){swishWaitPageData.willRedirect&&(s.log(`redirectToSwish: Redirecting to Swish app - ${swishWaitPageData.swishRedirectUrl}`,"wait-page"),window.location.replace(swishWaitPageData.swishRedirectUrl))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{(0,e.render)((0,e.createElement)(r,null),document.getElementById("swish-wait-page-root")),c()})):((0,e.render)((0,e.createElement)(r,null),document.getElementById("swish-wait-page-root")),c())}();