!function(){"use strict";var e=window.wp.element,t=window.wc.wcBlocksRegistry,n=window.wp.i18n,o=(window.React,window.wc.wcSettings);let a=!1;const s=()=>{const e=(0,o.getSetting)("swish_data",null);if(a||(console.log("swishServerData",e),a=!0),!e)throw new Error("Swish initialization data is not available");return e};let r=null;async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"react";const o=function(){if("undefined"!=typeof swishWaitPageData)return{ajaxUrl:swishWaitPageData.ajaxUrl,nonce:swishWaitPageData.nonce,frontendLogging:swishWaitPageData.frontendLogging};if("undefined"!=typeof swish)return{ajaxUrl:swish.ajaxurl,nonce:swish.nonce,frontendLogging:swish.frontendLogging};const e=function(){if(null!==r)return r;try{if("undefined"!=typeof wc&&wc.wcSettings&&"function"==typeof wc.wcSettings.getSetting){const e=wc.wcSettings.getSetting("swish_data",null);if(e)return r=e,e}}catch(e){}return r=!1,null}();return e?{ajaxUrl:e.ajaxUrl,nonce:e.nonce,frontendLogging:e.frontendLogging}:{ajaxUrl:null,nonce:null,frontendLogging:!1}}();if(!o.frontendLogging||!o.ajaxUrl)return void console.log(`[Swish:${n}] ${e}`);const a=new FormData;a.append("action","swish_frontend_log"),a.append("nonce",o.nonce),a.append("message",e),a.append("level",t),a.append("context",n);try{await fetch(o.ajaxUrl,{method:"POST",body:a,credentials:"same-origin"})}catch(e){console.error("[SwishLogger] Failed to send log:",e)}}const c={log:function(e){i(e,"info",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"react")},warn:function(e){i(e,"warning",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"react")},error:function(e){i(e,"error",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"react")}};var l=c;window.wp.components;const u={style:{base:{iconColor:"#666EE8",color:"#31325F",fontSize:((e,t,n)=>{let o={};if("object"==typeof document&&"function"==typeof document.querySelector&&"function"==typeof window.getComputedStyle){const e=document.querySelector(".wc-block-checkout");e&&(o=window.getComputedStyle(e))}return o.fontSize||"16px"})(),lineHeight:1.375,"::placeholder":{color:"#fff"}}},classes:{focus:"focused",empty:"empty",invalid:"has-error"}},g=t=>{const{className:n,label:o,id:a,value:r,placeholder:i,onChange:c}=t,[l,u]=React.useState(!1),g=s(),p=g?.mirror_number;return p&&React.useEffect((()=>{const e=document.getElementById("billing-phone");if(e){const t=e.value;if(t&&!r&&!l){const e=t.replace(/\D/g,"");c(e)}const n=e=>{const t=e.target.value.replace(/\D/g,"");c(t),u(!1)};return e.addEventListener("change",n),e.addEventListener("input",n),()=>{e.removeEventListener("change",n),e.removeEventListener("input",n)}}}),[c,r]),(0,e.createElement)("input",{className:n,label:o,id:a,placeholder:i,value:r,onChange:e=>{u(!0),c(e.target.value)}})},p=t=>{let{inputErrorComponent:o,onChange:a,paymentRequestData:r,setPayerAlias:i,payerAlias:c,showWaitModal:l}=t;const[p,m]=(0,e.useState)(!0),{options:d,onActive:w,error:h,setError:f}=(t=>{const[n,o]=(0,e.useState)(!1),[a,s]=(0,e.useState)({...u}),[r,i]=(0,e.useState)("");return(0,e.useEffect)((()=>{const e=n?"#CFD7E0":"#fff";s((t=>({...t,style:{...t.style,base:{...t.style.base,"::placeholder":{color:e}}}})))}),[n]),{options:a,onActive:(0,e.useCallback)((e=>{o(!e||(e=>!e))}),[o]),error:r,setError:i}})(),{logoText:y,logoImage:E,placeholder:S,label:v,m_payment:b,description:C}=s();return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"wc-swish-inline-element",id:"swish-description"},C),!b&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"wc-block-gateway-container wc-inline-card-element"},(0,e.createElement)(g,{id:"wc-swish-inline-element",className:"wc-block-gateway-input",value:c,options:d,placeholder:S,onBlur:()=>w(p),onFocus:()=>w(p),onChange:e=>{m(0===e.length),isNaN(e)?e.length>0&&"+"!=e.charAt(0)||isNaN(e.slice(1))?(f((0,n.__)("Use numbers and + only","woo-swish-e-commerce")),e=e.slice(0,-1)):f(""):e.length>0&&"0"!==e.charAt(0)&&"+"!==e.charAt(0)?(f((0,n.__)("First character in the number must be 0 or +","woo-swish-e-commerce")),e=e.slice(0,-1)):f(""),i(e),a(e)}}),(0,e.createElement)("label",{htmlFor:"wc-swish-inline-element"},v)),(0,e.createElement)(o,{errorMessage:h})))},m=t=>{let{eventRegistration:o,emitResponse:a,billing:s,components:r}=t;const{ValidationInputError:i}=r,[c,u]=(0,e.useState)(""),[g,m]=(0,e.useState)(!1),[d,w]=(0,e.useState)(""),h=((t,o,a,s,r,i,c,u,g)=>{const[p,m]=(0,e.useState)(""),d=(0,e.useCallback)((e=>{var t;const{type:o,code:a="",message:s}=e,r=null!==(t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e===errorTypes.API_ERROR?getMessageString(t):(0,n.__)("Unable to process your Swish payment, please try again or use alternative method.","woo-swish-e-commerce")}(o,a))&&void 0!==t?t:s;return l.error(`useCheckoutSubscriptions: Swish error - type: ${o}, code: ${a}, message: ${r}`,"payment-block"),m(r),r}),[]),{onCheckoutFail:w,onPaymentSetup:h}=t;return((t,n)=>{(0,e.useEffect)((()=>n((()=>(l.log("usePaymentProcessing: Payment setup with payer alias: "+(t?"***"+t.slice(-4):"empty"),"payment-block"),{type:"success",meta:{paymentMethodData:{"swish-payer-alias":t}}})))),[n,t])})(i,h),(0,e.useEffect)((()=>w((e=>{let{processingResponse:t}=e;return!t?.paymentDetails?.errorMessage||(l.error(`useCheckoutSubscriptions: Checkout failed - ${t.paymentDetails.errorMessage}`,"payment-block"),{type:o.responseTypes.ERROR,message:t.paymentDetails.errorMessage,messageContext:o.noticeContexts.PAYMENTS})}))),[w,o.noticeContexts.PAYMENTS,o.responseTypes.ERROR]),d})(o,a,0,0,0,d);return(0,e.createElement)(p,{showWaitModal:g,id:"swish-number",value:d,paymentRequestData:!0,setPayerAlias:w,payerAlias:d,onChange:e=>{e.error&&h(e),u("")},inputErrorComponent:i})};var d=window.wp.htmlEntities;const w=s(),h={name:"swish",label:(0,e.createElement)((t=>{const{PaymentMethodLabel:o}=t.components,a=s()?.icon,r=s()?.title,i=(0,e.createElement)("img",{src:a,alt:(0,d.decodeEntities)((0,n.__)("Swish","woo-swish-e-commerce")),align:"right"});return(0,e.createElement)("span",{className:"wc-swish-label-container",style:{width:"98%",display:"block"}},(0,e.createElement)(o,{text:r}),i)}),{props:!0}),content:(0,e.createElement)(m,{props:!0}),edit:(0,e.createElement)(m,{props:!0}),canMakePayment:()=>!0,ariaLabel:(0,n.__)("Swish payment method","woo-swish-e-commerce"),supports:{features:w.supports},paymentMethodId:"swish"};(0,t.registerPaymentMethod)(h)}();